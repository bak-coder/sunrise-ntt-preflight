---
description: Структура и протокол memory bank
globs: memory-bank/**
alwaysApply: false
---

# Memory Bank Protocol

## Структура

```
memory-bank/
├── projectBrief.md      # Что за проект, скоуп, цели — меняется редко
├── productContext.md    # Зачем и для кого, пользовательские сценарии
├── systemPatterns.md    # Архитектура, паттерны, ключевые решения
├── techContext.md       # Стек, зависимости, инфраструктура
├── activeContext.md     # Текущий фокус — меняется часто
└── progress.md          # Что сделано, что предстоит, блокеры
```

---

## Кто управляет файлами

| Файл | Читает | Пишет |
|---|---|---|
| Все файлы | Оркестратор (в начале сессии) | Только оркестратор |
| Task Brief (выжимка) | Субагент | — |

Субагенты **никогда** не обращаются к файлам memory bank напрямую.

---

## Шаблоны файлов

### activeContext.md
```markdown
# Active Context
_Обновлено: YYYY-MM-DD HH:MM_

## Текущий фокус
[Что сейчас в работе]

## Следующий шаг
[Конкретное следующее действие]

## Открытые вопросы
- [Вопрос 1]

## Последние решения
- [Решение и его причина]
```

### progress.md
```markdown
# Progress

## Завершено
- [YYYY-MM-DD] [Что сделано]

## В работе
- [Задача] — [статус]

## Предстоит
- [Задача]

## Блокеры
- [Блокер] — [что нужно для разблокировки]
```

### systemPatterns.md
```markdown
# System Patterns

## Архитектура
[Описание высокоуровневой архитектуры]

## Ключевые паттерны
### [Название паттерна]
- Где применяется:
- Почему выбран:
- Пример:

## Решения, которые НЕ принимаем
- [Что и почему исключено]
```

### techContext.md
```markdown
# Tech Context

## Стек
- Frontend:
- Backend:
- БД:
- Инфраструктура:

## Ключевые зависимости
| Пакет | Версия | Зачем |
|---|---|---|

## Конфигурация среды
[Важные env, настройки]

## Известные ограничения
- [Ограничение]
```

### projectBrief.md
```markdown
# Project Brief

## Суть проекта
[Одно предложение]

## Проблема, которую решаем
[2-3 предложения]

## Скоуп MVP
- [Что входит]

## Что НЕ входит в скоуп
- [Что исключено]

## Критерии успеха
- [Метрика / результат]
```

### productContext.md
```markdown
# Product Context

## Для кого
[Описание пользователя]

## Ключевые сценарии использования
1. [Сценарий]

## UX-принципы
- [Принцип]

## Бизнес-контекст
[Если релевантно]
```

---

## Правила обновления

### activeContext.md — snapshot overwrite
Этот файл **перезаписывается целиком** при каждом checkpoint. Он отражает только текущий момент — не историю. Не дописывай старые записи, замени весь файл новым снапшотом.  
История изменений фокуса и решений — в `progress.md`.

### Все остальные файлы — append
Дописывай новые записи в конец соответствующего раздела. Не удаляй существующие записи.

### Общие правила
1. **Всегда обновляй дату** в `activeContext.md` при перезаписи
2. **Будь конкретен** — избегай размытых формулировок типа "улучшен код"
3. **Одно обновление = один checkpoint** — не накапливай изменения через несколько задач
